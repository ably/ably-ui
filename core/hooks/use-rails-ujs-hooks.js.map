{"version":3,"sources":["../../../src/core/hooks/use-rails-ujs-hooks.ts"],"sourcesContent":["import { useEffect, RefObject } from \"react\";\n\ntype HttpMethod = \"get\" | \"post\" | \"put\" | \"patch\" | \"delete\";\n\ninterface RailsUjsLink extends HTMLAnchorElement {\n  dataset: {\n    method?: string;\n    confirm?: string;\n    remote?: string;\n  };\n}\n\ninterface CsrfMetaTag extends HTMLMetaElement {\n  content: string;\n}\n\nconst useRailsUjsLinks = (containerRef: RefObject<HTMLElement>): void => {\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    const handleClick = (event: MouseEvent): void => {\n      if (!(event.target instanceof HTMLElement)) {\n        return;\n      }\n\n      const target = event.target;\n      const link = target.closest<RailsUjsLink>(\"a[data-method]\");\n      if (!link) return;\n\n      // Check if the clicked link is within this component's container\n      if (!container.contains(link)) return;\n\n      event.preventDefault();\n\n      const method = (link.dataset.method?.toLowerCase() ??\n        \"get\") as HttpMethod;\n      const href = link.getAttribute(\"href\");\n\n      if (!href) {\n        console.warn(\"Rails UJS link has no href attribute\");\n        return;\n      }\n\n      // Only handle POST requests for now, expand for other methods if needed\n      if (method !== \"post\" && method !== \"delete\") return;\n\n      const csrfParam = document.querySelector<CsrfMetaTag>(\n        'meta[name=\"csrf-param\"]',\n      )?.content;\n\n      const csrfToken = document.querySelector<CsrfMetaTag>(\n        'meta[name=\"csrf-token\"]',\n      )?.content;\n\n      // Create and submit a hidden form\n      const form = document.createElement(\"form\");\n      form.method = \"POST\";\n      form.action = href;\n      form.style.display = \"none\";\n\n      // Add CSRF token if present\n      if (csrfParam && csrfToken) {\n        const csrfInput = document.createElement(\"input\");\n        csrfInput.type = \"hidden\";\n        csrfInput.name = csrfParam;\n        csrfInput.value = csrfToken;\n        form.appendChild(csrfInput);\n      } else {\n        console.warn(\"No CSRF token found in document\");\n      }\n\n      // Add method override for non-POST methods\n      if (method !== \"post\") {\n        const methodInput = document.createElement(\"input\");\n        methodInput.type = \"hidden\";\n        methodInput.name = \"_method\";\n        methodInput.value = method;\n        form.appendChild(methodInput);\n      }\n\n      document.body.appendChild(form);\n      form.submit();\n    };\n\n    container.addEventListener(\"click\", handleClick);\n    return () => container.removeEventListener(\"click\", handleClick);\n  }, [containerRef]);\n};\n\nexport default useRailsUjsLinks;\n"],"names":["useEffect","useRailsUjsLinks","containerRef","container","current","handleClick","event","target","HTMLElement","link","closest","contains","preventDefault","method","dataset","toLowerCase","href","getAttribute","console","warn","csrfParam","document","querySelector","content","csrfToken","form","createElement","action","style","display","csrfInput","type","name","value","appendChild","methodInput","body","submit","addEventListener","removeEventListener"],"mappings":"AAAA,OAASA,SAAS,KAAmB,OAAQ,CAgB7C,MAAMC,iBAAmB,AAACC,eACxBF,UAAU,KACR,MAAMG,UAAYD,aAAaE,OAAO,CACtC,GAAI,CAACD,UAAW,OAEhB,MAAME,YAAc,AAACC,QACnB,GAAI,CAAEA,CAAAA,MAAMC,MAAM,YAAYC,WAAU,EAAI,CAC1C,MACF,CAEA,MAAMD,OAASD,MAAMC,MAAM,CAC3B,MAAME,KAAOF,OAAOG,OAAO,CAAe,kBAC1C,GAAI,CAACD,KAAM,OAGX,GAAI,CAACN,UAAUQ,QAAQ,CAACF,MAAO,OAE/BH,MAAMM,cAAc,GAEpB,MAAMC,OAAUJ,KAAKK,OAAO,CAACD,MAAM,EAAEE,eACnC,MACF,MAAMC,KAAOP,KAAKQ,YAAY,CAAC,QAE/B,GAAI,CAACD,KAAM,CACTE,QAAQC,IAAI,CAAC,wCACb,MACF,CAGA,GAAIN,SAAW,QAAUA,SAAW,SAAU,OAE9C,MAAMO,UAAYC,SAASC,aAAa,CACtC,4BACCC,QAEH,MAAMC,UAAYH,SAASC,aAAa,CACtC,4BACCC,QAGH,MAAME,KAAOJ,SAASK,aAAa,CAAC,OACpCD,CAAAA,KAAKZ,MAAM,CAAG,MACdY,CAAAA,KAAKE,MAAM,CAAGX,IACdS,CAAAA,KAAKG,KAAK,CAACC,OAAO,CAAG,OAGrB,GAAIT,WAAaI,UAAW,CAC1B,MAAMM,UAAYT,SAASK,aAAa,CAAC,QACzCI,CAAAA,UAAUC,IAAI,CAAG,QACjBD,CAAAA,UAAUE,IAAI,CAAGZ,SACjBU,CAAAA,UAAUG,KAAK,CAAGT,UAClBC,KAAKS,WAAW,CAACJ,UACnB,KAAO,CACLZ,QAAQC,IAAI,CAAC,kCACf,CAGA,GAAIN,SAAW,OAAQ,CACrB,MAAMsB,YAAcd,SAASK,aAAa,CAAC,QAC3CS,CAAAA,YAAYJ,IAAI,CAAG,QACnBI,CAAAA,YAAYH,IAAI,CAAG,SACnBG,CAAAA,YAAYF,KAAK,CAAGpB,OACpBY,KAAKS,WAAW,CAACC,YACnB,CAEAd,SAASe,IAAI,CAACF,WAAW,CAACT,MAC1BA,KAAKY,MAAM,EACb,EAEAlC,UAAUmC,gBAAgB,CAAC,QAASjC,aACpC,MAAO,IAAMF,UAAUoC,mBAAmB,CAAC,QAASlC,YACtD,EAAG,CAACH,aAAa,CACnB,CAEA,gBAAeD,gBAAiB"}
{"version":3,"sources":["../../../src/core/insights/index.test.ts"],"sourcesContent":["/**\n * @vitest-environment jsdom\n */\n\nimport { describe, expect, beforeEach, afterEach, it, vi, Mock } from \"vitest\";\n\nimport * as datalayer from \"./datalayer\";\nimport * as mixpanel from \"./mixpanel\";\nimport * as posthog from \"./posthog\";\nimport * as logger from \"./logger\";\nimport * as insights from \"./index\";\n\n// Mock the dependencies\nvi.mock(\"./datalayer\", () => ({\n  track: vi.fn(),\n  trackPageView: vi.fn(),\n}));\n\nvi.mock(\"./mixpanel\", () => ({\n  initMixpanel: vi.fn(),\n  enableDebugMode: vi.fn(),\n  disableDebugMode: vi.fn(),\n  identify: vi.fn(),\n  trackPageView: vi.fn(),\n  track: vi.fn(),\n  startSessionRecording: vi.fn(),\n  stopSessionRecording: vi.fn(),\n}));\n\nvi.mock(\"./posthog\", () => ({\n  initPosthog: vi.fn(),\n  enableDebugMode: vi.fn(),\n  disableDebugMode: vi.fn(),\n  identify: vi.fn(),\n  trackPageView: vi.fn(),\n  track: vi.fn(),\n  startSessionRecording: vi.fn(),\n  stopSessionRecording: vi.fn(),\n}));\n\nvi.mock(\"./logger\", () => ({\n  debug: vi.fn(),\n  info: vi.fn(),\n  warn: vi.fn(),\n  error: vi.fn(),\n}));\n\ndescribe(\"Insights Command Queue\", () => {\n  const testConfig = {\n    debug: true,\n    mixpanelToken: \"test-token\",\n    mixpanelAutoCapture: false,\n    mixpanelRecordSessionsPercent: 10,\n    posthogApiKey: \"test-key\",\n    posthogApiHost: \"test-host\",\n  };\n\n  const testIdentity = {\n    userId: \"user-123\",\n    accountId: \"account-456\",\n    organisationId: \"org-789\",\n    email: \"test@example.com\",\n    name: \"Test User\",\n  };\n\n  beforeEach(() => {\n    // Clear all mocks before each test\n    vi.clearAllMocks();\n\n    // Reset the module to clear any internal state\n    vi.resetModules();\n  });\n\n  afterEach(() => {\n    // Cleanup document event listeners\n    document.body.replaceWith(document.body.cloneNode(true));\n  });\n\n  describe(\"Pre-initialization Queueing\", () => {\n    it(\"should queue methods called before initialization\", async () => {\n      // Call methods before initialization\n      insights.track(\"early_event\", { early: true });\n      insights.identify(testIdentity);\n      insights.trackPageView();\n\n      // Verify nothing has been called yet on the underlying services\n      expect(mixpanel.track).not.toHaveBeenCalled();\n      expect(posthog.track).not.toHaveBeenCalled();\n      expect(datalayer.track).not.toHaveBeenCalled();\n      expect(mixpanel.identify).not.toHaveBeenCalled();\n      expect(posthog.identify).not.toHaveBeenCalled();\n      expect(mixpanel.trackPageView).not.toHaveBeenCalled();\n      expect(posthog.trackPageView).not.toHaveBeenCalled();\n      expect(datalayer.trackPageView).not.toHaveBeenCalled();\n\n      // Now initialize\n      insights.initInsights(testConfig);\n\n      // Initialize should be called immediately\n      expect(mixpanel.initMixpanel).toHaveBeenCalledWith(\n        testConfig.mixpanelToken,\n        testConfig.mixpanelAutoCapture,\n        testConfig.debug,\n        testConfig.mixpanelRecordSessionsPercent,\n      );\n      expect(posthog.initPosthog).toHaveBeenCalledWith(\n        testConfig.posthogApiKey,\n        testConfig.posthogApiHost,\n      );\n\n      // Queued methods should now be called in the correct order\n      expect(mixpanel.track).toHaveBeenCalledWith(\"early_event\", {\n        early: true,\n      });\n      expect(posthog.track).toHaveBeenCalledWith(\"early_event\", {\n        early: true,\n      });\n      expect(datalayer.track).toHaveBeenCalledWith(\"early_event\", {\n        early: true,\n      });\n\n      expect(mixpanel.identify).toHaveBeenCalledWith(testIdentity);\n      expect(posthog.identify).toHaveBeenCalledWith(testIdentity);\n\n      expect(mixpanel.trackPageView).toHaveBeenCalled();\n      expect(posthog.trackPageView).toHaveBeenCalled();\n      expect(datalayer.trackPageView).not.toHaveBeenCalled();\n    });\n\n    it(\"should handle errors in queued methods gracefully\", async () => {\n      // Setup an error for one of the methods\n      (mixpanel.track as Mock).mockImplementationOnce(() => {\n        throw new Error(\"Mixpanel error\");\n      });\n\n      // Call methods before initialization\n      insights.track(\"error_event\", { error: true });\n      insights.trackPageView();\n\n      // Now initialize\n      insights.initInsights(testConfig);\n\n      // Should have logged the error but continued processing the queue\n      expect(logger.error).toHaveBeenCalledWith(\n        expect.stringContaining(\"Failed to track event in Mixpanel\"),\n        expect.any(Error),\n      );\n\n      // The other methods should still be called\n      expect(posthog.track).toHaveBeenCalledWith(\"error_event\", {\n        error: true,\n      });\n      expect(datalayer.track).toHaveBeenCalledWith(\"error_event\", {\n        error: true,\n      });\n      expect(mixpanel.trackPageView).toHaveBeenCalled();\n      expect(posthog.trackPageView).toHaveBeenCalled();\n      expect(datalayer.trackPageView).not.toHaveBeenCalled();\n    });\n\n    it(\"should report page view to GTM as well when includeDataLayer is true\", () => {\n      insights.trackPageView({ includeDataLayer: true });\n      expect(mixpanel.trackPageView).toHaveBeenCalled();\n      expect(posthog.trackPageView).toHaveBeenCalled();\n      expect(datalayer.trackPageView).toHaveBeenCalled();\n    });\n  });\n\n  describe(\"Post-initialization Direct Execution\", () => {\n    beforeEach(() => {\n      // Initialize first\n      insights.initInsights(testConfig);\n      // Clear the mocks to focus on post-init behavior\n      vi.clearAllMocks();\n    });\n\n    it(\"should directly call methods after initialization\", () => {\n      // Call methods after initialization\n      insights.track(\"post_init_event\", { post: true });\n\n      // Should be called immediately\n      expect(mixpanel.track).toHaveBeenCalledWith(\"post_init_event\", {\n        post: true,\n      });\n      expect(posthog.track).toHaveBeenCalledWith(\"post_init_event\", {\n        post: true,\n      });\n      expect(datalayer.track).toHaveBeenCalledWith(\"post_init_event\", {\n        post: true,\n      });\n    });\n\n    it(\"should handle all exported methods correctly\", () => {\n      // Test each exported method\n      insights.identify(testIdentity);\n      expect(mixpanel.identify).toHaveBeenCalledWith(testIdentity);\n      expect(posthog.identify).toHaveBeenCalledWith(testIdentity);\n\n      insights.trackPageView();\n      expect(mixpanel.trackPageView).toHaveBeenCalled();\n      expect(posthog.trackPageView).toHaveBeenCalled();\n      expect(datalayer.trackPageView).not.toHaveBeenCalled();\n\n      insights.startSessionRecording();\n      expect(mixpanel.startSessionRecording).toHaveBeenCalled();\n      expect(posthog.startSessionRecording).toHaveBeenCalled();\n\n      insights.stopSessionRecording();\n      expect(mixpanel.stopSessionRecording).toHaveBeenCalled();\n      expect(posthog.stopSessionRecording).toHaveBeenCalled();\n\n      insights.enableDebugMode();\n      expect(mixpanel.enableDebugMode).toHaveBeenCalled();\n      expect(posthog.enableDebugMode).toHaveBeenCalled();\n\n      insights.disableDebugMode();\n      expect(mixpanel.disableDebugMode).toHaveBeenCalled();\n      expect(posthog.disableDebugMode).toHaveBeenCalled();\n    });\n\n    it(\"should report page view to GTM as well when includeDataLayer is true\", () => {\n      insights.trackPageView({ includeDataLayer: true });\n      expect(mixpanel.trackPageView).toHaveBeenCalled();\n      expect(posthog.trackPageView).toHaveBeenCalled();\n      expect(datalayer.trackPageView).toHaveBeenCalled();\n    });\n  });\n\n  describe(\"Observer Setup\", () => {\n    beforeEach(() => {\n      insights.initInsights(testConfig);\n      vi.clearAllMocks();\n    });\n\n    it(\"should set up click event observer and track clicks\", () => {\n      // Setup observer\n      const cleanup = insights.setupObserver();\n\n      // Create a test element with insight attributes\n      const testElement = document.createElement(\"button\");\n      testElement.setAttribute(\"data-insight-event\", \"button_clicked\");\n      testElement.setAttribute(\"data-insight-button-id\", \"test-123\");\n      document.body.appendChild(testElement);\n\n      // Simulate click\n      testElement.click();\n\n      // Should track the event\n      expect(mixpanel.track).toHaveBeenCalledWith(\"button_clicked\", {\n        buttonId: \"test-123\",\n      });\n      expect(posthog.track).toHaveBeenCalledWith(\"button_clicked\", {\n        buttonId: \"test-123\",\n      });\n      expect(datalayer.track).toHaveBeenCalledWith(\"button_clicked\", {\n        buttonId: \"test-123\",\n      });\n\n      // Test cleanup\n      cleanup();\n\n      // Reset tracking mocks\n      vi.clearAllMocks();\n\n      // Click again - should not track\n      testElement.click();\n      expect(mixpanel.track).not.toHaveBeenCalled();\n    });\n\n    it(\"should handle nested elements correctly\", () => {\n      // Setup observer\n      insights.setupObserver();\n\n      // Create parent element with insight attributes\n      const parentElement = document.createElement(\"div\");\n      parentElement.setAttribute(\"data-insight-event\", \"container_clicked\");\n      parentElement.setAttribute(\n        \"data-insight-container-id\",\n        \"parent-container\",\n      );\n\n      // Create child element without insights\n      const childElement = document.createElement(\"span\");\n      childElement.textContent = \"Click me\";\n\n      // Nest elements\n      parentElement.appendChild(childElement);\n      document.body.appendChild(parentElement);\n\n      // Click the child element\n      childElement.click();\n\n      // Should find and use the parent's insight attributes\n      expect(mixpanel.track).toHaveBeenCalledWith(\"container_clicked\", {\n        containerId: \"parent-container\",\n      });\n    });\n  });\n\n  describe(\"Error Handling\", () => {\n    it(\"should handle initialization errors gracefully\", () => {\n      // Setup an error in initialization\n      (mixpanel.initMixpanel as Mock).mockImplementationOnce(() => {\n        throw new Error(\"Mixpanel init error\");\n      });\n\n      // Should not throw when initializing\n      expect(() => {\n        insights.initInsights(testConfig);\n      }).not.toThrow();\n\n      // Should log the error\n      expect(logger.error).toHaveBeenCalledWith(\n        expect.stringContaining(\"Failed to initialize Mixpanel\"),\n        expect.any(Error),\n      );\n    });\n\n    it(\"should handle runtime errors in methods\", () => {\n      // Initialize first\n      insights.initInsights(testConfig);\n      vi.clearAllMocks();\n\n      // Setup errors in tracking\n      (mixpanel.track as Mock).mockImplementationOnce(() => {\n        throw new Error(\"Mixpanel track error\");\n      });\n\n      (posthog.track as Mock).mockImplementationOnce(() => {\n        throw new Error(\"Posthog track error\");\n      });\n\n      // Should not throw when tracking\n      expect(() => {\n        insights.track(\"error_test\", { test: true });\n      }).not.toThrow();\n\n      // Should log the errors\n      expect(logger.error).toHaveBeenCalledWith(\n        expect.stringContaining(\"Failed to track event in Mixpanel\"),\n        expect.any(Error),\n      );\n\n      expect(logger.error).toHaveBeenCalledWith(\n        expect.stringContaining(\"Failed to track event in Posthog\"),\n        expect.any(Error),\n      );\n\n      // Should still try to track with datalayer\n      expect(datalayer.track).toHaveBeenCalledWith(\"error_test\", {\n        test: true,\n      });\n    });\n  });\n\n  describe(\"Debug Mode\", () => {\n    it(\"should respect debug flag in config\", () => {\n      // Initialize with debug: true\n      insights.initInsights(testConfig);\n\n      // Should log debug messages\n      expect(logger.debug).toHaveBeenCalledWith(\n        expect.stringContaining(\"Initializing insights\"),\n      );\n\n      // Clear mocks and test tracking\n      vi.clearAllMocks();\n      insights.track(\"debug_test\", { debug: true });\n\n      // Should log info about tracking\n      expect(logger.info).toHaveBeenCalledWith(\n        expect.stringContaining(\"Tracking event\"),\n        expect.objectContaining({\n          event: \"debug_test\",\n          properties: { debug: true },\n        }),\n      );\n    });\n\n    it(\"should not log debug info when debug is false\", () => {\n      // Initialize with debug: false\n      insights.initInsights({\n        ...testConfig,\n        debug: false,\n      });\n\n      // Clear mocks and test tracking\n      vi.clearAllMocks();\n      insights.track(\"no_debug_test\", { debug: false });\n\n      // Should not log info about tracking\n      expect(logger.info).not.toHaveBeenCalled();\n    });\n  });\n\n  describe(\"Arbitrary Properties\", () => {\n    const customPageViewProperties = {\n      customProperty: \"custom-value\",\n      anotherProperty: 123,\n      nestedObject: { foo: \"bar\" },\n    };\n\n    const customPageViewPropertiesWithDataLayer = {\n      customProperty: \"custom-value\",\n      anotherProperty: 456,\n    };\n\n    const customPageViewPropertiesWithExcludeIds = {\n      customProperty: \"test\",\n      count: 789,\n    };\n\n    const customIdentityProperties = {\n      customProperty: \"user-custom-value\",\n      userSegment: \"premium\",\n      signupDate: \"2024-01-01\",\n    };\n\n    const customMinimalIdentityProperties = {\n      customField1: \"value1\",\n      customField2: 999,\n      customField3: { nested: true },\n    };\n\n    beforeEach(() => {\n      insights.initInsights(testConfig);\n      vi.clearAllMocks();\n    });\n\n    it(\"should pass arbitrary properties through trackPageView\", () => {\n      // Call trackPageView with custom properties\n      insights.trackPageView(customPageViewProperties);\n\n      // Verify mixpanel received all properties\n      expect(mixpanel.trackPageView).toHaveBeenCalledWith(\n        customPageViewProperties,\n      );\n\n      // Verify posthog received all properties\n      expect(posthog.trackPageView).toHaveBeenCalledWith(\n        customPageViewProperties,\n      );\n\n      // Verify datalayer did not receive anything (includeDataLayer not set)\n      expect(datalayer.trackPageView).not.toHaveBeenCalled();\n    });\n\n    it(\"should pass arbitrary properties through trackPageView with includeDataLayer\", () => {\n      // Call trackPageView with custom properties and includeDataLayer\n      insights.trackPageView({\n        includeDataLayer: true,\n        ...customPageViewPropertiesWithDataLayer,\n      });\n\n      // Verify mixpanel received custom properties (includeDataLayer filtered out)\n      expect(mixpanel.trackPageView).toHaveBeenCalledWith(\n        customPageViewPropertiesWithDataLayer,\n      );\n\n      // Verify posthog received custom properties (includeDataLayer filtered out)\n      expect(posthog.trackPageView).toHaveBeenCalledWith(\n        customPageViewPropertiesWithDataLayer,\n      );\n\n      // Verify datalayer received custom properties (includeDataLayer filtered out)\n      expect(datalayer.trackPageView).toHaveBeenCalledWith(\n        customPageViewPropertiesWithDataLayer,\n      );\n    });\n\n    it(\"should pass arbitrary properties through trackPageView with excludeIds\", () => {\n      const excludeIds = [\"id1\", \"id2\"];\n\n      // Call trackPageView with custom properties and excludeIds\n      insights.trackPageView({\n        excludeIds,\n        ...customPageViewPropertiesWithExcludeIds,\n      });\n\n      // Verify mixpanel received excludeIds and custom properties\n      expect(mixpanel.trackPageView).toHaveBeenCalledWith({\n        excludeIds,\n        ...customPageViewPropertiesWithExcludeIds,\n      });\n\n      // Verify posthog received only custom properties (excludeIds filtered out)\n      expect(posthog.trackPageView).toHaveBeenCalledWith(\n        customPageViewPropertiesWithExcludeIds,\n      );\n    });\n\n    it(\"should pass arbitrary properties through identify\", () => {\n      const identityWithCustomProps = {\n        ...testIdentity,\n        ...customIdentityProperties,\n      };\n\n      // Call identify with custom properties\n      insights.identify(identityWithCustomProps);\n\n      // Verify mixpanel received all properties\n      expect(mixpanel.identify).toHaveBeenCalledWith(identityWithCustomProps);\n\n      // Verify posthog received all properties\n      expect(posthog.identify).toHaveBeenCalledWith(identityWithCustomProps);\n    });\n\n    it(\"should pass arbitrary properties through identify with minimal identity\", () => {\n      const minimalIdentity = {\n        userId: \"minimal-user\",\n        accountId: \"minimal-account\",\n        ...customMinimalIdentityProperties,\n      };\n\n      // Call identify with only required fields plus custom properties\n      insights.identify(minimalIdentity);\n\n      // Verify mixpanel received all properties\n      expect(mixpanel.identify).toHaveBeenCalledWith(minimalIdentity);\n\n      // Verify posthog received all properties\n      expect(posthog.identify).toHaveBeenCalledWith(minimalIdentity);\n    });\n  });\n});\n"],"names":["describe","expect","beforeEach","afterEach","it","vi","datalayer","mixpanel","posthog","logger","insights","mock","track","fn","trackPageView","initMixpanel","enableDebugMode","disableDebugMode","identify","startSessionRecording","stopSessionRecording","initPosthog","debug","info","warn","error","testConfig","mixpanelToken","mixpanelAutoCapture","mixpanelRecordSessionsPercent","posthogApiKey","posthogApiHost","testIdentity","userId","accountId","organisationId","email","name","clearAllMocks","resetModules","document","body","replaceWith","cloneNode","early","not","toHaveBeenCalled","initInsights","toHaveBeenCalledWith","mockImplementationOnce","Error","stringContaining","any","includeDataLayer","post","cleanup","setupObserver","testElement","createElement","setAttribute","appendChild","click","buttonId","parentElement","childElement","textContent","containerId","toThrow","test","objectContaining","event","properties","customPageViewProperties","customProperty","anotherProperty","nestedObject","foo","customPageViewPropertiesWithDataLayer","customPageViewPropertiesWithExcludeIds","count","customIdentityProperties","userSegment","signupDate","customMinimalIdentityProperties","customField1","customField2","customField3","nested","excludeIds","identityWithCustomProps","minimalIdentity"],"mappings":"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"}
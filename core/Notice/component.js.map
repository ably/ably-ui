{"version":3,"sources":["../../../src/core/Notice/component.js"],"sourcesContent":["import Cookie from \"js-cookie\";\nimport { throttle } from \"es-toolkit/compat\";\n\nimport { queryId } from \"../dom-query\";\nimport { FLASH_DATA_ID } from \"../Flash\";\n\nconst COOKIE_EXPIRY = 90;\nexport const COLLAPSE_TRIGGER_DISTANCE = 5;\nconst SCROLL_LISTENER_THROTTLE = 100;\nconst RESIZE_LISTENER_THROTTLE = 100;\n\nconst isMdViewport = () => !window.matchMedia(`(min-width: 65rem)`).matches;\n\nconst adjustFlashMargin = (open) => {\n  // HACK ALERT\n  // Add margin to flashes when opening the notice.\n  // Flashes are react components and this notice needs to work as a view-component and react component.\n  // We could do this with redux but then we potentially update state on every scroll event, which\n  // even with debounce will deplate our frame budget.\n\n  const flash = queryId(FLASH_DATA_ID);\n\n  if (flash) {\n    flash.style.marginTop = open ? `4rem` : null;\n  }\n};\n\nconst hideOnMobile = (bannerContainer) => {\n  if (isMdViewport()) {\n    bannerContainer.style.display = \"none\";\n  } else {\n    bannerContainer.style.display = null;\n  }\n};\n\nconst hideNotice = (bannerContainer) => {\n  bannerContainer.classList.remove(\"ui-announcement-visible\");\n  bannerContainer.classList.add(\"ui-announcement-hidden\");\n\n  adjustFlashMargin(false);\n};\n\nconst showNotice = (bannerContainer) => {\n  bannerContainer.classList.remove(\"ui-announcement-hidden\");\n  bannerContainer.classList.add(\"ui-announcement-visible\");\n\n  adjustFlashMargin(true);\n};\n\nconst setupRememberClosed = (cookieId, noticeId) => {\n  const cookie = Cookie.get(cookieId) || \"\";\n\n  Cookie.set(cookieId, `${cookie.replace(`${noticeId},`, \"\") + noticeId},`, {\n    expires: COOKIE_EXPIRY,\n  });\n};\n\nconst hasBeenClosedBefore = (cookieId, noticeId) =>\n  (Cookie.get(cookieId) || \"\").includes(noticeId);\n\nconst setupNoticeCollapse = (bannerContainer) => {\n  const scrollTop = window.scrollY;\n\n  if (scrollTop > COLLAPSE_TRIGGER_DISTANCE) {\n    hideNotice(bannerContainer);\n  }\n\n  const listener = throttle(() => {\n    const scrollTop = window.scrollY;\n\n    if (scrollTop > COLLAPSE_TRIGGER_DISTANCE) {\n      hideNotice(bannerContainer);\n    } else if (bannerContainer.classList.contains(\"ui-announcement-hidden\")) {\n      showNotice(bannerContainer);\n    }\n  }, SCROLL_LISTENER_THROTTLE);\n\n  document.addEventListener(\"scroll\", listener);\n\n  return () => document.removeEventListener(\"scroll\", listener);\n};\n\nconst setupCloseBtn = (\n  bannerContainer,\n  cookieId,\n  noticeId,\n  collapseUnmountListeners,\n) => {\n  const closeBtn = bannerContainer.querySelector(\"button\");\n\n  if (!closeBtn) return () => {};\n\n  const listener = () => {\n    if (cookieId && noticeId) setupRememberClosed(cookieId, noticeId);\n\n    hideNotice(bannerContainer);\n    collapseUnmountListeners();\n  };\n\n  closeBtn.addEventListener(\"click\", listener);\n\n  return () => closeBtn.removeEventListener(\"click\", listener);\n};\n\nconst resizeHandler = (bannerContainer) => {\n  const handler = throttle(() => {\n    hideOnMobile(bannerContainer);\n  }, RESIZE_LISTENER_THROTTLE);\n\n  window.addEventListener(\"resize\", handler);\n\n  return () => window.removeEventListener(\"resize\", handler);\n};\n\nconst Notice = ({ bannerContainer, cookieId, noticeId, options }) => {\n  if (typeof window === \"undefined\") return () => {};\n\n  if (!bannerContainer) {\n    console.warn(\n      \"A Notice component was initited but no notice container was found.\",\n    );\n    return () => {};\n  }\n\n  if (hasBeenClosedBefore(cookieId, noticeId)) return () => {};\n\n  hideOnMobile(bannerContainer);\n  showNotice(bannerContainer);\n\n  const opts = { collapse: true, ...options };\n\n  const collapseUnmountListeners = opts.collapse\n    ? setupNoticeCollapse(bannerContainer)\n    : () => {};\n\n  const closeBtnUnmountListeners = setupCloseBtn(\n    bannerContainer,\n    cookieId,\n    noticeId,\n    collapseUnmountListeners,\n  );\n\n  const resizeUnmountListener = resizeHandler(bannerContainer);\n\n  return () => {\n    [\n      closeBtnUnmountListeners,\n      collapseUnmountListeners,\n      resizeUnmountListener,\n    ].forEach((unmount) => unmount());\n  };\n};\n\nexport default Notice;\n"],"names":["Cookie","throttle","queryId","FLASH_DATA_ID","COOKIE_EXPIRY","COLLAPSE_TRIGGER_DISTANCE","SCROLL_LISTENER_THROTTLE","RESIZE_LISTENER_THROTTLE","isMdViewport","window","matchMedia","matches","adjustFlashMargin","open","flash","style","marginTop","hideOnMobile","bannerContainer","display","hideNotice","classList","remove","add","showNotice","setupRememberClosed","cookieId","noticeId","cookie","get","set","replace","expires","hasBeenClosedBefore","includes","setupNoticeCollapse","scrollTop","scrollY","listener","contains","document","addEventListener","removeEventListener","setupCloseBtn","collapseUnmountListeners","closeBtn","querySelector","resizeHandler","handler","Notice","options","console","warn","opts","collapse","closeBtnUnmountListeners","resizeUnmountListener","forEach","unmount"],"mappings":"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"}